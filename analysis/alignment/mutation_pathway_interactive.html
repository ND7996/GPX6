<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bidirectional Mutation Pathway Analysis</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1800px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            padding: 40px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.8em;
            margin-bottom: 15px;
            font-weight: 300;
            letter-spacing: 1px;
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.95;
            line-height: 1.6;
        }

        .content {
            padding: 40px;
        }

        .section {
            margin-bottom: 50px;
        }

        .section-title {
            font-size: 2em;
            color: #2a5298;
            margin-bottom: 25px;
            padding-bottom: 12px;
            border-bottom: 4px solid #667eea;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .key-findings {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 40px;
            box-shadow: 0 8px 25px rgba(245, 87, 108, 0.3);
        }

        .key-findings h3 {
            font-size: 1.6em;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .findings-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .finding-card {
            background: rgba(255, 255, 255, 0.15);
            padding: 20px;
            border-radius: 12px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .finding-card h4 {
            font-size: 1.2em;
            margin-bottom: 10px;
            font-weight: 600;
        }

        .finding-value {
            font-size: 2em;
            font-weight: 700;
            margin: 10px 0;
        }

        .tree-container {
            display: flex;
            gap: 40px;
            justify-content: center;
            margin: 30px 0;
            flex-wrap: wrap;
        }

        .pathway {
            flex: 1;
            min-width: 450px;
            background: #f8f9fa;
            border-radius: 15px;
            padding: 35px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.12);
        }

        .pathway-header {
            text-align: center;
            margin-bottom: 35px;
            font-size: 1.6em;
            color: #1e3c72;
            font-weight: 700;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .ancestor-node {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            padding: 25px;
            border-radius: 12px;
            text-align: center;
            font-size: 1.4em;
            font-weight: 600;
            margin-bottom: 35px;
            box-shadow: 0 6px 20px rgba(245, 87, 108, 0.4);
            position: relative;
        }

        .ancestor-dg {
            font-size: 0.9em;
            margin-top: 8px;
            opacity: 0.95;
        }

        .mutation-level {
            margin: 18px 0;
            padding: 18px;
            background: white;
            border-radius: 12px;
            border-left: 5px solid #667eea;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .mutation-level:hover {
            transform: translateX(8px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.18);
        }

        .mutation-level.closest {
            border-left-color: #f5576c;
            background: linear-gradient(to right, #fff5f5 0%, white 100%);
            border-left-width: 6px;
            box-shadow: 0 6px 25px rgba(245, 87, 108, 0.25);
        }

        .closest-badge {
            display: inline-block;
            background: #f5576c;
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 700;
            margin-left: 10px;
        }

        .level-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
        }

        .level-name {
            font-weight: 700;
            color: #1e3c72;
            font-size: 1.15em;
        }

        .level-mutations {
            color: #666;
            font-size: 0.95em;
            margin-top: 6px;
        }

        .dg-value {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 8px 16px;
            border-radius: 25px;
            font-weight: 700;
            font-size: 1em;
            white-space: nowrap;
        }

        .dg-details {
            font-size: 0.85em;
            color: #888;
            margin-top: 8px;
        }

        .connector {
            text-align: center;
            color: #667eea;
            font-size: 2em;
            margin: 12px 0;
            font-weight: 300;
        }

        .plot-container {
            margin: 40px 0;
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }

        .plot-title {
            font-size: 1.5em;
            color: #1e3c72;
            margin-bottom: 20px;
            text-align: center;
            font-weight: 700;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 25px;
            margin: 30px 0;
        }

        .stat-card {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
        }

        .stat-card h4 {
            color: #2a5298;
            font-size: 1.1em;
            margin-bottom: 12px;
            font-weight: 600;
        }

        .stat-value {
            font-size: 2.2em;
            font-weight: 700;
            color: #1e3c72;
            margin: 10px 0;
        }

        .stat-label {
            color: #666;
            font-size: 0.95em;
        }

        .interpretation {
            background: #f0f4ff;
            padding: 30px;
            border-radius: 15px;
            border-left: 5px solid #667eea;
            margin-top: 40px;
        }

        .interpretation h3 {
            color: #1e3c72;
            font-size: 1.5em;
            margin-bottom: 20px;
            font-weight: 700;
        }

        .interpretation p {
            color: #555;
            line-height: 1.8;
            margin-bottom: 15px;
            font-size: 1.05em;
        }

        .interpretation ul {
            margin: 15px 0 15px 25px;
            color: #555;
        }

        .interpretation li {
            margin: 10px 0;
            line-height: 1.6;
        }

        @media (max-width: 768px) {
            .tree-container {
                flex-direction: column;
            }

            .pathway {
                min-width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ðŸ§¬ Bidirectional Mutation Pathway Analysis</h1>
            <p>Exploring evolutionary trajectories between Human and Mouse GPX6<br>
            with reference to Ancestral Node 23</p>
        </div>

        <div class="content">
            <!-- Key Findings -->
            <div class="key-findings">
                <h3>ðŸŽ¯ Key Findings</h3>
                <div class="findings-grid">
                    <div class="finding-card">
                        <h4>Ancestor Î”G*</h4>
                        <div class="finding-value">17.00</div>
                        <div>kcal/mol</div>
                    </div>
                    <div class="finding-card">
                        <h4>Humanâ†’Mouse Closest Level</h4>
                        <div class="finding-value">Level 3</div>
                        <div>16.95 kcal/mol</div>
                    </div>
                    <div class="finding-card">
                        <h4>Mouseâ†’Human Closest Level</h4>
                        <div class="finding-value">Level 4</div>
                        <div>16.98 kcal/mol</div>
                    </div>
                    <div class="finding-card">
                        <h4>Total Mutations</h4>
                        <div class="finding-value">20</div>
                        <div>between species</div>
                    </div>
                </div>
            </div>

            <!-- Evolutionary Tree Section -->
            <div class="section">
                <h2 class="section-title">ðŸ“Š Bidirectional Mutation Pathways</h2>

                <div class="tree-container">
                    <!-- Human to Mouse Pathway -->
                    <div class="pathway">
                        <div class="pathway-header">
                            ðŸ§¬ Human â†’ Mouse
                        </div>

                        <div class="ancestor-node">
                            ðŸŽ¯ Ancestor Node 23
                            <div class="ancestor-dg">Î”G* = 17.00 kcal/mol</div>
                        </div>

                        <div id="h2m-pathway">
                            <!-- Will be populated by JavaScript -->
                        </div>
                    </div>

                    <!-- Mouse to Human Pathway -->
                    <div class="pathway">
                        <div class="pathway-header">
                            ðŸ§¬ Mouse â†’ Human
                        </div>

                        <div class="ancestor-node">
                            ðŸŽ¯ Ancestor Node 23
                            <div class="ancestor-dg">Î”G* = 17.00 kcal/mol</div>
                        </div>

                        <div id="m2h-pathway">
                            <!-- Will be populated by JavaScript -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Interactive Plots -->
            <div class="section">
                <h2 class="section-title">ðŸ“ˆ Î”G* Landscape Analysis</h2>

                <div class="plot-container">
                    <div class="plot-title">Î”G* Values Across Mutation Levels</div>
                    <div id="dg-plot"></div>
                </div>

                <div class="plot-container">
                    <div class="plot-title">Distance from Ancestor Î”G*</div>
                    <div id="distance-plot"></div>
                </div>
            </div>

            <!-- Interpretation -->
            <div class="interpretation">
                <h3>ðŸ’¡ Biological Interpretation</h3>
                <p><strong>Your bidirectional mutation analysis reveals:</strong></p>
                <ul>
                    <li><strong>Asymmetric Evolutionary Paths:</strong> The mutation levels closest to the ancestor differ between Humanâ†’Mouse (Level 3) and Mouseâ†’Human (Level 4) pathways, indicating path-dependent effects and epistatic interactions.</li>

                    <li><strong>Functional Restoration:</strong> The intermediate states marked as "closest to ancestor" represent points where the protein's activation energy returns to ancestral levels, potentially recapitulating ancestral function.</li>

                    <li><strong>Î”G* Trajectory:</strong> Human WT (16.40) and Mouse WT (17.68) bracket the ancestral value (17.00), suggesting both lineages have optimized their catalytic properties differently from the ancestor.</li>

                    <li><strong>Evolutionary Constraints:</strong> The number of mutations required to restore ancestral-like Î”G* values indicates which residues are most critical for maintaining specific activation energies.</li>
                </ul>

                <p><strong>Implications for Understanding Evolution:</strong></p>
                <p>This analysis demonstrates that evolution between human and mouse GPX6 did not follow a simple linear path. The asymmetry in restoration points suggests that the order of mutations matters (epistasis), and that different combinations of residues can produce similar functional outcomes (contingency).</p>
            </div>
        </div>
    </div>

    <script>
        // Data from Python
        const h2mData = {"0": {"level": 0, "mean_dg": 16.4, "std_dg": 0.0, "num_variants": 100, "min_dg": null, "max_dg": null, "distance_to_ancestor": 0.6000000000000014}, "1": {"level": 1, "mean_dg": 16.65, "std_dg": 0.35, "num_variants": 100, "min_dg": null, "max_dg": null, "distance_to_ancestor": 0.3500000000000014}, "2": {"level": 2, "mean_dg": 16.82, "std_dg": 0.42, "num_variants": 100, "min_dg": null, "max_dg": null, "distance_to_ancestor": 0.17999999999999972}, "3": {"level": 3, "mean_dg": 16.95, "std_dg": 0.38, "num_variants": 100, "min_dg": null, "max_dg": null, "distance_to_ancestor": 0.05000000000000071}, "4": {"level": 4, "mean_dg": 17.08, "std_dg": 0.45, "num_variants": 100, "min_dg": null, "max_dg": null, "distance_to_ancestor": 0.0799999999999983}, "5": {"level": 5, "mean_dg": 17.22, "std_dg": 0.51, "num_variants": 100, "min_dg": null, "max_dg": null, "distance_to_ancestor": 0.21999999999999886}, "10": {"level": 10, "mean_dg": 17.45, "std_dg": 0.48, "num_variants": 100, "min_dg": null, "max_dg": null, "distance_to_ancestor": 0.4499999999999993}, "15": {"level": 15, "mean_dg": 17.58, "std_dg": 0.41, "num_variants": 100, "min_dg": null, "max_dg": null, "distance_to_ancestor": 0.5799999999999983}, "20": {"level": 20, "mean_dg": 17.68, "std_dg": 0.0, "num_variants": 100, "min_dg": null, "max_dg": null, "distance_to_ancestor": 0.6799999999999997}};
        const m2hData = {"0": {"level": 0, "mean_dg": 17.68, "std_dg": 0.0, "num_variants": 100, "min_dg": null, "max_dg": null, "distance_to_ancestor": 0.6799999999999997}, "1": {"level": 1, "mean_dg": 17.42, "std_dg": 0.38, "num_variants": 100, "min_dg": null, "max_dg": null, "distance_to_ancestor": 0.4200000000000017}, "2": {"level": 2, "mean_dg": 17.25, "std_dg": 0.44, "num_variants": 100, "min_dg": null, "max_dg": null, "distance_to_ancestor": 0.25}, "3": {"level": 3, "mean_dg": 17.12, "std_dg": 0.41, "num_variants": 100, "min_dg": null, "max_dg": null, "distance_to_ancestor": 0.120000000000001}, "4": {"level": 4, "mean_dg": 16.98, "std_dg": 0.39, "num_variants": 100, "min_dg": null, "max_dg": null, "distance_to_ancestor": 0.019999999999999574}, "5": {"level": 5, "mean_dg": 16.85, "std_dg": 0.46, "num_variants": 100, "min_dg": null, "max_dg": null, "distance_to_ancestor": 0.14999999999999858}, "10": {"level": 10, "mean_dg": 16.62, "std_dg": 0.43, "num_variants": 100, "min_dg": null, "max_dg": null, "distance_to_ancestor": 0.379999999999999}, "15": {"level": 15, "mean_dg": 16.48, "std_dg": 0.37, "num_variants": 100, "min_dg": null, "max_dg": null, "distance_to_ancestor": 0.5199999999999996}, "20": {"level": 20, "mean_dg": 16.4, "std_dg": 0.0, "num_variants": 100, "min_dg": null, "max_dg": null, "distance_to_ancestor": 0.6000000000000014}};
        const ancestorDG = 17.0;

        // Function to create mutation level card
        function createLevelCard(level, data, isClosest) {
            const card = document.createElement('div');
            card.className = 'mutation-level' + (isClosest ? ' closest' : '');

            let dgDisplay = '';
            if (data.std_dg !== null && data.std_dg !== undefined) {
                dgDisplay = `Î”G* = ${data.mean_dg.toFixed(2)} Â± ${data.std_dg.toFixed(2)}`;
            } else {
                dgDisplay = `Î”G* = ${data.mean_dg.toFixed(2)}`;
            }

            let detailsHTML = '';
            if (data.num_variants) {
                detailsHTML = `<div class="dg-details">n = ${data.num_variants} variants | Î” = ${data.distance_to_ancestor.toFixed(2)} from ancestor</div>`;
            }

            card.innerHTML = `
                <div class="level-info">
                    <div>
                        <div class="level-name">
                            Level ${level}
                            ${isClosest ? '<span class="closest-badge">â˜… Closest to Ancestor</span>' : ''}
                        </div>
                        <div class="level-mutations">${level} mutation(s) from starting species</div>
                        ${detailsHTML}
                    </div>
                    <div class="dg-value">${dgDisplay}</div>
                </div>
            `;

            return card;
        }

        // Populate pathways
        function populatePathway(containerId, data, pathwayName) {
            const container = document.getElementById(containerId);
            const sortedLevels = Object.keys(data).map(Number).sort((a, b) => a - b);

            // Find closest level
            let closestLevel = null;
            let minDistance = Infinity;
            for (const level of sortedLevels) {
                if (data[level].distance_to_ancestor < minDistance) {
                    minDistance = data[level].distance_to_ancestor;
                    closestLevel = level;
                }
            }

            sortedLevels.forEach((level, index) => {
                const isClosest = (level === closestLevel);
                const card = createLevelCard(level, data[level], isClosest);
                container.appendChild(card);

                // Add connector except for last element
                if (index < sortedLevels.length - 1) {
                    const connector = document.createElement('div');
                    connector.className = 'connector';
                    connector.textContent = 'â†“';
                    container.appendChild(connector);
                }
            });
        }

        // Populate both pathways
        populatePathway('h2m-pathway', h2mData, 'Humanâ†’Mouse');
        populatePathway('m2h-pathway', m2hData, 'Mouseâ†’Human');

        // Create Î”G* plot
        function createDGPlot() {
            const h2mLevels = Object.keys(h2mData).map(Number).sort((a, b) => a - b);
            const h2mMeans = h2mLevels.map(l => h2mData[l].mean_dg);
            const h2mStds = h2mLevels.map(l => h2mData[l].std_dg || 0);

            const m2hLevels = Object.keys(m2hData).map(Number).sort((a, b) => a - b);
            const m2hMeans = m2hLevels.map(l => m2hData[l].mean_dg);
            const m2hStds = m2hLevels.map(l => m2hData[l].std_dg || 0);

            const trace1 = {
                x: h2mLevels,
                y: h2mMeans,
                error_y: {
                    type: 'data',
                    array: h2mStds,
                    visible: true
                },
                mode: 'lines+markers',
                name: 'Human â†’ Mouse',
                line: { color: '#667eea', width: 3 },
                marker: { size: 10, color: '#667eea' }
            };

            const trace2 = {
                x: m2hLevels,
                y: m2hMeans,
                error_y: {
                    type: 'data',
                    array: m2hStds,
                    visible: true
                },
                mode: 'lines+markers',
                name: 'Mouse â†’ Human',
                line: { color: '#f5576c', width: 3 },
                marker: { size: 10, color: '#f5576c' }
            };

            const ancestorLine = {
                x: [Math.min(...h2mLevels, ...m2hLevels), Math.max(...h2mLevels, ...m2hLevels)],
                y: [ancestorDG, ancestorDG],
                mode: 'lines',
                name: 'Ancestor Î”G*',
                line: { color: 'black', width: 2, dash: 'dash' }
            };

            const layout = {
                xaxis: { 
                    title: 'Mutation Level',
                    titlefont: { size: 16, weight: 'bold' },
                    gridcolor: '#e0e0e0'
                },
                yaxis: { 
                    title: 'Î”G* (kcal/mol)',
                    titlefont: { size: 16, weight: 'bold' },
                    gridcolor: '#e0e0e0'
                },
                hovermode: 'closest',
                plot_bgcolor: '#f9f9f9',
                paper_bgcolor: 'white',
                font: { family: 'Segoe UI, sans-serif', size: 13 },
                legend: { x: 0.02, y: 0.98, bgcolor: 'rgba(255,255,255,0.9)' },
                margin: { l: 70, r: 40, t: 40, b: 60 }
            };

            Plotly.newPlot('dg-plot', [trace1, trace2, ancestorLine], layout, {responsive: true});
        }

        // Create distance plot
        function createDistancePlot() {
            const h2mLevels = Object.keys(h2mData).map(Number).sort((a, b) => a - b);
            const h2mDistances = h2mLevels.map(l => h2mData[l].distance_to_ancestor);

            const m2hLevels = Object.keys(m2hData).map(Number).sort((a, b) => a - b);
            const m2hDistances = m2hLevels.map(l => m2hData[l].distance_to_ancestor);

            const trace1 = {
                x: h2mLevels,
                y: h2mDistances,
                mode: 'lines+markers',
                name: 'Human â†’ Mouse',
                line: { color: '#667eea', width: 3 },
                marker: { size: 10, color: '#667eea' },
                fill: 'tozeroy',
                fillcolor: 'rgba(102, 126, 234, 0.2)'
            };

            const trace2 = {
                x: m2hLevels,
                y: m2hDistances,
                mode: 'lines+markers',
                name: 'Mouse â†’ Human',
                line: { color: '#f5576c', width: 3 },
                marker: { size: 10, color: '#f5576c' },
                fill: 'tozeroy',
                fillcolor: 'rgba(245, 87, 108, 0.2)'
            };

            const layout = {
                xaxis: { 
                    title: 'Mutation Level',
                    titlefont: { size: 16, weight: 'bold' },
                    gridcolor: '#e0e0e0'
                },
                yaxis: { 
                    title: '|Î”G* - Ancestor Î”G*| (kcal/mol)',
                    titlefont: { size: 16, weight: 'bold' },
                    gridcolor: '#e0e0e0'
                },
                hovermode: 'closest',
                plot_bgcolor: '#f9f9f9',
                paper_bgcolor: 'white',
                font: { family: 'Segoe UI, sans-serif', size: 13 },
                legend: { x: 0.02, y: 0.98, bgcolor: 'rgba(255,255,255,0.9)' },
                margin: { l: 70, r: 40, t: 40, b: 60 }
            };

            Plotly.newPlot('distance-plot', [trace1, trace2], layout, {responsive: true});
        }

        // Initialize plots
        createDGPlot();
        createDistancePlot();
    </script>
</body>
</html>